<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hey Shawtyyy üíû ‚Äî Welcome Back</title>
  <style>
    /* ---------------- Theme ---------------- */
    :root{
      --bg1:#ffd1ea; --bg2:#cdb4ff; --accent:#ff6fb5;
      --card: rgba(255,255,255,0.94);
      --glass: rgba(255,255,255,0.10);
      --shadow: 0 12px 36px rgba(75,30,90,0.14);
      --maxw:980px;
      font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;cursor:default;background:linear-gradient(135deg,var(--bg1),var(--bg2));}
    body{display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}

    /* ---------------- Stage ---------------- */
    .stage{
      width:100%;max-width:var(--maxw);
      background: linear-gradient(180deg, rgba(255,255,255,0.72), rgba(255,255,255,0.6));
      border-radius:22px;padding:26px;box-shadow:var(--shadow);position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.6);
    }

    /* ---------------- Greetings (stacked typewriter) ---------------- */
    .greetings{text-align:center;padding:10px 6px 18px 6px;}
    h1{font-size:34px;margin:6px 0;color:#4b235a;}
    .sub{color:#5e3e6f;margin:8px 0 0 0;font-size:16px}
    #animLine{display:block;text-align:center;margin-top:10px;font-weight:600;color:#4b235a}
    #animLine div{margin-top:8px}

    /* ---------------- Letters ---------------- */
    .letters-wrap{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;padding:18px 12px;}
    .env{
      width:120px;height:92px;background:linear-gradient(180deg,#fff7fb,#fff0ff);
      border-radius:12px;position:relative;display:flex;align-items:center;justify-content:center;
      cursor:pointer;box-shadow:0 10px 30px rgba(90,40,90,0.08);transform-origin:center;transition:transform .22s,box-shadow .22s;
    }
    .env:hover{transform:translateY(-8px) rotate(-3deg);box-shadow:0 18px 40px rgba(90,40,90,0.12)}
    .env .seal{position:absolute;right:10px;top:8px;background:linear-gradient(90deg,#ff6fb5,#a064f0);color:white;padding:6px 8px;border-radius:10px;font-weight:700;font-size:12px;}
    .env .icon{font-size:34px}
    .env.pop-in{animation:popIn .7s cubic-bezier(.2,.9,.3,1) both;}
    @keyframes popIn{0%{opacity:0;transform:translateY(30px) scale(.8) rotate(6deg)}60%{transform:translateY(-6px) scale(1.04) rotate(-2deg)}100%{opacity:1;transform:translateY(0) scale(1) rotate(0)}}

    /* ---------------- Modal ---------------- */
    .modal-backdrop{position:fixed;inset:0;background:rgba(12,6,20,0.45);display:flex;align-items:center;justify-content:center;z-index:120;backdrop-filter: blur(4px);}
    .modal{width:92%;max-width:620px;background:var(--card);border-radius:14px;padding:18px;box-shadow:0 18px 50px rgba(40,10,60,0.28);transform:translateY(18px);opacity:0;transition:all .24s ease-out}
    .modal.show{transform:translateY(0);opacity:1}
    .modal h3{margin:0 0 8px 0;color:#3d1745}
    .modal p{margin:0;color:#5b3d61;line-height:1.45;font-size:15px}
    .close-btn{display:inline-block;margin-top:14px;padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,#a064f0,#ff6fb5);color:white;font-weight:700;border:none;cursor:pointer}

    /* photo gallery inside modal */
    .gallery{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .gallery img{width:140px;height:100px;object-fit:cover;border-radius:10px;border:2px solid rgba(255,255,255,0.6);cursor:pointer}
    .caption{font-size:13px;color:#6b3f60;margin-top:8px}

    /* ---------------- Decorations ---------------- */
    .decor{position:absolute;inset:0;pointer-events:none;z-index:10}
    .spark{position:absolute;font-size:18px;opacity:0.95;pointer-events:none}
    @keyframes floaty {0%{transform:translateY(0) translateX(0) scale(1);opacity:1}100%{transform:translateY(-420px) translateX(40px) scale(1.3);opacity:0}}

    /* ---------------- Controls / Panels ---------------- */
    .controls{display:flex;gap:12px;align-items:center;justify-content:center;padding:12px}
    .btn{padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,#ff6fb5,#a064f0);color:white;font-weight:700;cursor:pointer}
    .small{padding:6px 8px;font-size:13px}

    /* ---------------- Mini elements ---------------- */
    .star{font-size:18px;cursor:pointer;user-select:none}
    .heartCatch{position:fixed;font-size:28px;cursor:pointer;z-index:1001;transition:transform .14s}

    /* responsive */
    @media (max-width:560px){ h1{font-size:28px} .env{width:100px;height:80px} .gallery img{width:100px;height:70px} }
  </style>
</head>
<body>
  <div class="stage" role="main" aria-labelledby="title">
    <div class="greetings">
      <h1 id="title">Hey Shawtyyy üíû</h1>
      <div class="sub">
        <div id="animLine"></div>
      </div>
      <div style="margin-top:10px;color:#6b3f60;font-size:13px">(Click the letters to open your surprise ‚ú®)</div>
    </div>

    <!-- Letters -->
    <div class="letters-wrap" id="lettersWrap" aria-hidden="false">
      <div class="env pop-in" data-index="0" role="button" tabindex="0"><div class="icon">‚úâÔ∏è</div><div class="seal">1</div></div>
      <div class="env pop-in" data-index="1" role="button" tabindex="0"><div class="icon">‚úâÔ∏è</div><div class="seal">2</div></div>
      <div class="env pop-in" data-index="2" role="button" tabindex="0"><div class="icon">‚úâÔ∏è</div><div class="seal">3</div></div>
      <div class="env pop-in" data-index="3" role="button" tabindex="0"><div class="icon">‚úâÔ∏è</div><div class="seal">4</div></div>
      <div class="env pop-in" data-index="4" role="button" tabindex="0"><div class="icon">‚úâÔ∏è</div><div class="seal">5</div></div>
    </div>

    <!-- Controls area -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;align-items:center;padding:10px 12px;">
      <button class="btn" id="playMusic">Play Music ‚ñ∂</button>
      <button class="btn small" id="rainBtn">Food Rain</button>
      <button class="btn small" id="starBtn">Wish-a-Star</button>
      <button class="btn small" id="catchBtn">Catch the kittens</button>
      <button class="btn small" id="finalBtn">Final Surprise</button>
    </div>

    <!-- Unlock puzzle and daily notes -->
    <div style="display:flex;gap:12px;justify-content:center;padding-bottom:12px;flex-wrap:wrap;">
      <div style="background:var(--card);padding:10px;border-radius:12px;box-shadow:var(--shadow)">
        <div style="font-weight:700">Unlock a secret üíå</div>
        <div style="margin-top:8px"><input id="unlockInput" placeholder="Type my nickname" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/></div>
        <div style="margin-top:8px"><button class="btn small" id="unlockBtn">Unlock</button></div>
        <div id="unlockFeedback" style="margin-top:8px;color:#6b3f60;font-size:13px"></div>
      </div>

      <div style="background:var(--card);padding:10px;border-radius:12px;box-shadow:var(--shadow);max-width:360px">
        <div style="font-weight:700">Daily Notes üóíÔ∏è</div>
        <div id="notes" style="margin-top:8px;color:#6b3f60;font-size:14px;line-height:1.4">
          <div>Day 1: Sent you a million texts (in my head).</div>
          <div>Day 5: Ate pizza, still thinking of you üòÖ</div>
        </div>
        <div style="margin-top:8px"><input id="noteInput" placeholder="Write a new note" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"/></div>
        <div style="margin-top:8px"><button class="btn small" id="addNoteBtn">Add Note</button></div>
      </div>
    </div>

    <div id="modalRoot" aria-live="polite"></div>
    <div class="decor" id="decorLayer" aria-hidden="true"></div>
  </div>

  <!-- Cute cat (bottom-right) -->
  <img id="cat" src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="cat"
       style="position:fixed;bottom:18px;right:18px;width:94px;z-index:9999;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.18);transition:transform .18s ease;cursor:pointer;">

  <script>
  /* -------------------------
     Data & messages
     -------------------------*/
  const LETTER_MESSAGES = [
    "You really left me alone for 10 whole days, huh? The audacity üò§ (missed you though üôà)",
    "I hope you didn‚Äôt forget meüòá",
    "If missing you was homework, I‚Äôd have topped the class üìöüíò",
    "I made this just to remind you how special you are... and maybe flex my creativity a little üòé‚ú®",
    "Welcome back, Shawtyyy üéÄ ‚Äî now text me nonstop üòÜüì±"
  ];

  const SECRET_REVEALS = [
    "Psst ‚Äî I wrote your name on the clouds today ‚òÅÔ∏è",
    "Secret: Missed u very much üòû",
    "Hidden: I kept a cookie for you üç™ (not really, but I wanted to)",
    "Surprise: I drew a tiny star with your initials ‚ú®",
    "Also don't forget to watch all reels that i sent üòè"
  ];

  /* -------------
     Utilities: sound + safe fallbacks
     -------------*/
  function safeAudio(url, vol=0.2){
    try{
      const a = new Audio(url);
      a.volume = vol;
      a.preload = 'auto';
      return a;
    }catch(e){ return null; }
  }
  // small polite sounds (public domain/CC0 short beeps) - replace URLs if prefer local hosting
  const POP_SOUND = safeAudio('https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/pop1.mp3',0.18) || null;
  const DING_SOUND = safeAudio('https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/ding1.mp3',0.18) || null;
  const STAR_SOUND = safeAudio('https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/tinkle1.mp3',0.16) || null;
  const CAT_SOUND = safeAudio('https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/meow1.mp3',0.14) || null;

  function play(sound){
    if(!sound) return;
    try{ sound.currentTime = 0; sound.play().catch(()=>{}); }catch(e){}
  }

  /* -------------------------
     Greeting: stacked typewriter (lines stack)
     -------------------------*/
  (function typewriterGreetings(){
    const lines = [
      "Hey Shawtyyy üíû",
      "Welcome back üå∏",
      "While you were at your event‚Ä¶",
      "I made something special for you üí´",
      "Ready to see it? Click the letters below üëá"
    ];
    const animLine = document.getElementById('animLine');
    animLine.innerHTML = '';
    let i=0;
    function typeLine(line, cb){
      let idx=0;
      const lineEl = document.createElement('div');
      lineEl.style.opacity = 0;
      animLine.appendChild(lineEl);
      // fade-in for the new line container
      setTimeout(()=> lineEl.style.transition = 'opacity .18s', 20);
      lineEl.style.opacity = 1;
      const interval = setInterval(()=>{
        lineEl.textContent += line[idx];
        if(DING_SOUND && idx % 6 === 0) play(DING_SOUND); // occasional ding while typing
        idx++;
        if(idx >= line.length){
          clearInterval(interval);
          setTimeout(cb, 520);
        }
      }, 55);
    }
    function showNext(){ if(i < lines.length) { typeLine(lines[i], ()=>{ i++; showNext(); }); } }
    showNext();
  })();

  /* -------------------------
     Floating hearts in background (Idea 9)
     -------------------------*/
  const decor = document.getElementById('decorLayer');
  function spawnFloating(){
    const el = document.createElement('div');
    el.className = 'spark';
    const emojis=['üíñ','üëª','üí´','‚ú®','üå∏'];
    el.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    const size = 12 + Math.random()*22;
    el.style.fontSize = size + 'px';
    el.style.left = (5 + Math.random()*90) + '%';
    el.style.top = (55 + Math.random()*40) + '%';
    el.style.opacity = 1;
    el.style.transform = 'translateY(0)';
    decor.appendChild(el);
    // animate with CSS-like timing using JS
    const dur = 4200 + Math.random()*4200;
    el.animate([
      { transform: 'translateY(0) translateX(0) scale(1)', opacity: 1 },
      { transform: `translateY(-${120 + Math.random()*360}px) translateX(${Math.random()*60-30}px) scale(1.2)`, opacity: 0 }
    ], { duration: dur, easing: 'linear' });
    setTimeout(()=> el.remove(), dur + 50);
  }
  let floatInt = setInterval(spawnFloating, 700);
  document.addEventListener('visibilitychange', ()=> {
    if(document.hidden) clearInterval(floatInt);
    else floatInt = setInterval(spawnFloating,700);
  });

  /* -------------------------
     Envelopes => open modal with secret reveals, confetti & sounds (Ideas 2 + 3 + 4)
     -------------------------*/
  const envEls = Array.from(document.querySelectorAll('.env'));
  const modalRoot = document.getElementById('modalRoot');
  let openedCount = 0;
  function confettiAt(x,y,parent){
    // create several emoji particles that float outwards
    const emojis=['üíñ','‚ú®','üå∏','üëª','üí´'];
    for(let i=0;i<18;i++){
      const p = document.createElement('div');
      p.className = 'spark';
      p.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      p.style.fontSize = (10+Math.random()*18) + 'px';
      p.style.left = (x - 12 + (Math.random()*60-30)) + 'px';
      p.style.top = (y - 12 + (Math.random()*40-20)) + 'px';
      p.style.position = 'fixed';
      p.style.zIndex = 1400;
      document.body.appendChild(p);
      const dx = (Math.random()*200-100);
      const dy = -(120 + Math.random()*220);
      p.animate([
        { transform: 'translate(0,0) scale(1)', opacity: 1 },
        { transform: `translate(${dx}px, ${dy}px) scale(1.2)`, opacity:0 }
      ], { duration: 900 + Math.random()*600, easing: 'cubic-bezier(.15,.9,.25,1)'});
      setTimeout(()=> p.remove(), 1600);
    }
  }

  function openModal(index){
    // play sound
    play(POP_SOUND); play(DING_SOUND);
    openedCount++;
    // create backdrop & modal
    const backdrop = document.createElement('div'); backdrop.className = 'modal-backdrop';
    const modal = document.createElement('div'); modal.className = 'modal';
    setTimeout(()=> modal.classList.add('show'), 20);
    const h = document.createElement('h3'); h.textContent = `Letter ${index+1}`;
    const p = document.createElement('p'); p.innerHTML = LETTER_MESSAGES[index] || '...';
    // reveal secret small bit (click-to-reveal)
    const secretBox = document.createElement('div');
    secretBox.style.marginTop = '12px';
    secretBox.innerHTML = `<div style="font-weight:700;color:#6b3f60">Secret reveal üîí</div>
      <div style="margin-top:8px"><button class="btn small" id="revealBtn">Reveal</button>
      <div id="secretText" style="margin-top:8px;color:#5b3d61;font-size:14px"></div></div>`;

    // optionally include gallery for a specific letter (e.g., letter 3)
    if(index === 2){
      const gTitle = document.createElement('div'); gTitle.style.fontWeight='700'; gTitle.style.marginTop='12px'; gTitle.textContent='Memory Gallery üì∏';
      const gallery = document.createElement('div'); gallery.className = 'gallery';
      // placeholder images (user can click to upload later)
      const sample = [ ];
      sample.forEach(src=>{
        const img = document.createElement('img'); img.src = src; img.alt='memory';
        img.addEventListener('click', ()=> {
          // enlarge viewer
          showImageViewer(src);
        });
        gallery.appendChild(img);
      });
      modal.appendChild(gTitle); modal.appendChild(gallery);
    }

    const close = document.createElement('button'); close.className = 'close-btn'; close.textContent = 'Close ‚ú®';
    close.addEventListener('click', ()=> { backdrop.remove(); checkFinalUnlock(); });

    modal.appendChild(h); modal.appendChild(p); modal.appendChild(secretBox); modal.appendChild(close);
    backdrop.appendChild(modal);
    backdrop.addEventListener('click', (e)=> { if(e.target === backdrop) backdrop.remove(); });
    backdrop.addEventListener('keydown', (e)=> { if(e.key === 'Escape') backdrop.remove(); });
    modalRoot.appendChild(backdrop);

    // small confetti from center of viewport
    const cx = window.innerWidth/2, cy = window.innerHeight/2;
    confettiAt(cx, cy);

    // reveal logic
    const revealBtn = modal.querySelector('#revealBtn');
    const secretText = modal.querySelector('#secretText');
    revealBtn.addEventListener('click', ()=>{
      play(STAR_SOUND);
      secretText.textContent = SECRET_REVEALS[index] || 'You are pure magic ‚ú®';
      // a little extra confetti
      confettiAt(cx + (Math.random()*200-100), cy - 40);
    });

    // focus close for accessibility
    close.focus();
  }

  function showImageViewer(src){
    // simple full-screen image viewer
    const backdrop = document.createElement('div'); backdrop.className = 'modal-backdrop';
    const modal = document.createElement('div'); modal.className = 'modal'; modal.style.maxWidth='880px';
    setTimeout(()=> modal.classList.add('show'), 20);
    const img = document.createElement('img'); img.src = src; img.style.width='100%'; img.style.borderRadius='10px';
    const close = document.createElement('button'); close.className='close-btn'; close.textContent='Close';
    close.addEventListener('click', ()=> backdrop.remove());
    modal.appendChild(img); modal.appendChild(close); backdrop.appendChild(modal);
    backdrop.addEventListener('click',(e)=> { if(e.target===backdrop) backdrop.remove(); });
    modalRoot.appendChild(backdrop);
  }

  envEls.forEach(el=>{
    el.addEventListener('click', ()=> {
      const idx = parseInt(el.dataset.index,10);
      el.animate([
        { transform: 'translateY(0) rotate(0)' },
        { transform: 'translateY(-8px) rotate(-5deg) scale(1.02)' },
        { transform: 'translateY(0) rotate(0)' }
      ], { duration: 420, easing: 'cubic-bezier(.2,.9,.3,1)' });
      openModal(idx);
    });
    el.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); el.click(); } });
  });

  /* -------------------------
     Food rain (Idea 1)
     -------------------------*/
  let rainActive = false;
  function startRain(){
    if(rainActive) return;
    rainActive = true;
    let count = 0;
    const interval = setInterval(()=> {
      const e = document.createElement('div');
      e.className = 'spark';
      const symbols = ['üçï','üçî','üçü','üç¶'];
      e.textContent = symbols[Math.floor(Math.random()*symbols.length)];
      e.style.position = 'fixed';
      e.style.left = (10 + Math.random()*80) + '%';
      e.style.top = '-20px';
      e.style.fontSize = (14 + Math.random()*26) + 'px';
      e.style.zIndex = 1100;
      document.body.appendChild(e);
      const dur = 2800 + Math.random()*1600;
      e.animate([
        { transform: 'translateY(0) rotate(0)', opacity:1 },
        { transform: `translateY(${window.innerHeight + 80}px) rotate(${Math.random()*360-180}deg)`, opacity:0.15 }
      ], { duration: dur, easing: 'linear' });
      setTimeout(()=> e.remove(), dur + 100);
      count++;
      if(count > 40){ clearInterval(interval); rainActive=false; }
    }, 120);
  }

  document.getElementById('rainBtn').addEventListener('click', ()=> { startRain(); play(POP_SOUND); });

  /* -------------------------
     Wish-a-star (Idea 2 variant clickable stars)
     -------------------------*/
  let starActive = false;
  function spawnStar(x,y){
    const s = document.createElement('div');
    s.className = 'spark';
    s.style.position = 'fixed';
    s.style.left = x + 'px';
    s.style.top = y + 'px';
    s.textContent = '‚≠ê';
    s.style.fontSize = '20px';
    s.style.zIndex = 1200;
    document.body.appendChild(s);
    s.addEventListener('click', ()=> {
      play(STAR_SOUND);
      const tip = document.createElement('div');
      tip.className = 'modal-backdrop'; tip.style.background = 'transparent'; tip.style.zIndex=1400;
      const bubble = document.createElement('div'); bubble.className='modal'; bubble.style.maxWidth='420px';
      bubble.innerHTML = `<div style="font-weight:700">A little wish ‚ú®</div><div style="margin-top:8px;color:#5b3d61">${randomWish()}</div><div style="margin-top:12px;text-align:right"><button class="close-btn">Close</button></div>`;
      tip.appendChild(bubble); document.body.appendChild(tip);
      bubble.querySelector('button').addEventListener('click', ()=> tip.remove());
      s.remove();
    });
    // float and fade
    s.animate([{transform:'translateY(0)',opacity:1},{transform:'translateY(-120px)',opacity:0}],{duration:4200,easing:'linear'});
    setTimeout(()=> s.remove(), 4400);
  }
  function randomWish(){
    const arr = ["You deserve every bit of peace in the world.","Someone's super proud of you right now.","May your days be full of tiny joys.","Keep shining ‚Äî you‚Äôre magic."];
    return arr[Math.floor(Math.random()*arr.length)];
  }
  document.getElementById('starBtn').addEventListener('click', ()=>{
    play(STAR_SOUND);
    // spawn a few stars across screen
    for(let i=0;i<6;i++){
      setTimeout(()=> spawnStar(80 + Math.random()*(window.innerWidth-160), 120 + Math.random()*260), i*220);
    }
  });

  /* -------------------------
     Catch the heart mini game (Idea 3)
     -------------------------*/
  let catchActive=false;
  function spawnCatchHeart(){
    const h = document.createElement('div'); h.className='heartCatch'; h.textContent='üò∫';
    const x = 80 + Math.random()*(window.innerWidth-160), y = 120 + Math.random()*(window.innerHeight-300);
    h.style.left = x + 'px'; h.style.top = y + 'px';
    document.body.appendChild(h);
    h.addEventListener('click', ()=> {
      play(DING_SOUND);
      confettiAt(x,y);
      // reveal a quick secret message on catch
      const tip = document.createElement('div'); tip.className='modal-backdrop'; tip.style.background='transparent'; tip.style.zIndex=1400;
      const bubble = document.createElement('div'); bubble.className='modal'; bubble.style.maxWidth='380px';
      bubble.innerHTML = `<div style="font-weight:700">You caught my heart üíò</div><div style="margin-top:8px;color:#5b3d61">${randomWish()}</div><div style="margin-top:12px;text-align:right"><button class="close-btn">Close</button></div>`;
      tip.appendChild(bubble); document.body.appendChild(tip);
      bubble.querySelector('button').addEventListener('click', ()=> tip.remove());
      h.remove();
    });
    // animate to random move
    const dur = 4200 + Math.random()*2200;
    h.animate([{transform:'translate(0,0)'},{transform:`translate(${Math.random()*300-150}px, ${Math.random()*-180}px)`}],{duration:dur,iterations:Infinity,direction:'alternate',easing:'ease-in-out'});
    // remove after some time
    setTimeout(()=> { if(h.parentNode) h.remove(); }, 20000);
  }
  document.getElementById('catchBtn').addEventListener('click', ()=>{
    // spawn several hearts over time
    for(let i=0;i<6;i++) setTimeout(()=> spawnCatchHeart(), i*500);
  });

  /* -------------------------
     Photo gallery: allowing user uploads into letter 3 (Idea 4)
     -------------------------*/
  // Add a hidden file input and listen when user clicks the gallery area to upload
  const fileInput = document.createElement('input'); fileInput.type='file'; fileInput.accept='image/*'; fileInput.multiple=false; fileInput.style.display='none';
  document.body.appendChild(fileInput);
  fileInput.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    // if a gallery modal is open, append, else show a quick viewer
    showImageViewer(url);
  });

  /* -------------------------
     Unlock puzzle (Idea 5)
     -------------------------*/
  document.getElementById('unlockBtn').addEventListener('click', ()=>{
    const val = document.getElementById('unlockInput').value.trim().toLowerCase();
    const feedback = document.getElementById('unlockFeedback');
    if(val === 'shawtyyy' || val === 'shawty') {
      feedback.textContent = 'Unlocked! You found a tiny secret üéâ';
      // show small modal reveal
      const tip = document.createElement('div'); tip.className='modal-backdrop'; tip.style.zIndex=1400;
      const bubble = document.createElement('div'); bubble.className='modal';
      bubble.innerHTML = `<div style="font-weight:700">Secret unlocked üíå</div><div style="margin-top:8px;color:#5b3d61">You are my favorite chapter in every book.</div><div style="margin-top:12px;text-align:right"><button class="close-btn">Close</button></div>`;
      tip.appendChild(bubble); document.body.appendChild(tip);
      bubble.querySelector('button').addEventListener('click', ()=> tip.remove());
      play(DING_SOUND);
    } else {
      feedback.textContent = 'Not quite ‚Äî try the nickname!';
      play(POP_SOUND);
    }
  });

  /* -------------------------
     Daily notes add
     -------------------------*/
  document.getElementById('addNoteBtn').addEventListener('click', ()=>{
    const val = document.getElementById('noteInput').value.trim();
    if(!val) return;
    const notes = document.getElementById('notes');
    const div = document.createElement('div'); div.textContent = val;
    notes.appendChild(div);
    document.getElementById('noteInput').value = '';
    play(DING_SOUND);
  });

  /* -------------------------
     Cat interactions (Idea 9 upgrades)
     -------------------------*/
  const cat = document.getElementById('cat');
  cat.addEventListener('click', (e)=>{
    // pat animation
    cat.style.transform = 'scale(.92) rotate(-6deg)';
    setTimeout(()=> cat.style.transform = 'scale(1) rotate(0deg)', 220);
    play(CAT_SOUND);
    // hearts burst near cat
    const rect = cat.getBoundingClientRect();
    confettiAt(rect.left + rect.width/2, rect.top + 10);
  });
  // optional small hover waggle
  cat.addEventListener('mouseenter', ()=> cat.style.transform='scale(1.03) translateY(-6px)');
  cat.addEventListener('mouseleave', ()=> cat.style.transform='scale(1) translateY(0)');

  /* -------------------------
     Music Mood Switcher (Idea 6)
     -------------------------*/
  // Simple music using short loops (external mp3s). Using oscillator fallback if unavailable.
  let musicAudio = null;
  let currentMood = 'chill'; // 'chill' | 'fun' | 'romantic'
  const MOODS = {
    chill: 'https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/chill_loop.mp3',
    fun:   'https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/fun_loop.mp3',
    romantic: 'https://cdn.jsdelivr.net/gh/jwagner/simple-sounds@main/romantic_loop.mp3'
  };
  // create small mood controls appended near Play button
  (function createMoodControls(){
    const playBtn = document.getElementById('playMusic');
    const container = playBtn.parentNode;
    const select = document.createElement('select');
    select.style.marginLeft='8px'; select.style.padding='8px'; select.style.borderRadius='8px';
    select.innerHTML = `<option value="chill">Chill</option><option value="fun">Fun</option><option value="romantic">Romantic</option>`;
    select.addEventListener('change', ()=>{
      currentMood = select.value;
      if(musicAudio && !musicAudio.paused){ startMusic(); } // restart with new mood
    });
    container.appendChild(select);
  })();

  function startMusic(){
    if(musicAudio){ try{ musicAudio.pause(); musicAudio.remove(); }catch(e){} musicAudio=null; }
    const src = MOODS[currentMood];
    if(src){
      musicAudio = new Audio(src);
      musicAudio.loop = true; musicAudio.volume = 0.18;
      musicAudio.play().catch(()=>{ /* autoplay blocked until user gesture */ });
      document.getElementById('playMusic').textContent = 'Pause Music ‚è∏';
    }
  }
  function stopMusic(){
    if(musicAudio){ musicAudio.pause(); musicAudio=null; document.getElementById('playMusic').textContent = 'Play Music ‚ñ∂'; }
  }
  document.getElementById('playMusic').addEventListener('click', ()=>{
    if(musicAudio && !musicAudio.paused){ stopMusic(); } else startMusic();
  });

  /* -------------------------
     Color mood transition (Idea 7)
     -------------------------*/
  // cycle the background gradient slowly when final surprise is activated or via mood
  function setGradient(a,b){
    document.body.style.background = `linear-gradient(135deg, ${a}, ${b})`;
  }
  // subtle automatic slow shift
  let gradIdx=0;
  const gradients = [
    ['#ffd1ea','#cdb4ff'],
    ['#ffe0d6','#d6c8ff'],
    ['#fbe7ff','#cde8ff']
  ];
  setInterval(()=> {
    gradIdx = (gradIdx+1) % gradients.length;
    setGradient(gradients[gradIdx][0], gradients[gradIdx][1]);
  }, 22000);

  /* -------------------------
     Final Surprise (Idea 10): shows when many interactions done
     -------------------------*/
  function checkFinalUnlock(){
    // simple rule: if user opened 4+ letters or used 3 features, show final unique modal
    if(openedCount >= 5){
      setTimeout(()=> {
        const existing = document.getElementById('finalModal');
        if(existing) return;
        const backdrop = document.createElement('div'); backdrop.className='modal-backdrop'; backdrop.id='finalModal';
        const modal = document.createElement('div'); modal.className='modal';
        setTimeout(()=> modal.classList.add('show'),20);
        modal.innerHTML = `<div style="font-weight:700;font-size:18px">A little secret‚Ä¶</div>
          <div style="margin-top:10px;color:#5b3d61">A final surprise for u, i made one firework show for u in minecraft. Let's see that. Welcome back, Shawtyyy üíñ</div>
          <div style="margin-top:12px;text-align:right"><button class="close-btn">Close</button></div>`;
        backdrop.appendChild(modal); document.body.appendChild(backdrop);
        modal.querySelector('button').addEventListener('click', ()=> backdrop.remove());
        confettiAt(window.innerWidth/2, window.innerHeight/2);
        play(DING_SOUND);
      }, 700);
    }
  }

  // explicit Final Surprise button
  document.getElementById('finalBtn').addEventListener('click', ()=> {
    openedCount = Math.max(openedCount, 5);
    checkFinalUnlock();
  });

  // small cleanup on unload
  window.addEventListener('beforeunload', ()=> {
    clearInterval(floatInt);
    try{ if(musicAudio) musicAudio.pause(); }catch(e){}
  });

  // small helper: show image viewer (also used earlier)
  function showImageViewer(src){
    const backdrop = document.createElement('div'); backdrop.className='modal-backdrop';
    const modal = document.createElement('div'); modal.className='modal'; modal.style.maxWidth='880px';
    setTimeout(()=> modal.classList.add('show'),20);
    const img = document.createElement('img'); img.src = src; img.style.width='100%'; img.style.borderRadius='10px';
    const close = document.createElement('button'); close.className='close-btn'; close.textContent='Close';
    close.addEventListener('click', ()=> backdrop.remove());
    modal.appendChild(img); modal.appendChild(close); backdrop.appendChild(modal);
    backdrop.addEventListener('click',(e)=> { if(e.target===backdrop) backdrop.remove(); });
    modalRoot.appendChild(backdrop);
  }
  </script>
</body>
</html>
